Generic code that is shared between multiple layout algorithms